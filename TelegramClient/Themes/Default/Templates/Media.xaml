<ResourceDictionary
    x:Class="TelegramClient.Themes.Default.Templates.Media"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:micro="clr-namespace:Caliburn.Micro;assembly=Caliburn.Micro.Platform"
    xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
    xmlns:behaviors="clr-namespace:TelegramClient.Behaviors"
    xmlns:controls="clr-namespace:TelegramClient.Views.Controls"
    xmlns:emojiPanel="clr-namespace:Telegram.EmojiPanel"
    xmlns:additional="clr-namespace:TelegramClient.Views.Additional"
    xmlns:dialogs="clr-namespace:TelegramClient.Views.Dialogs"
    xmlns:views="clr-namespace:TelegramClient.Views"
    xmlns:themes="clr-namespace:TelegramClient.Themes"
    xmlns:converters="clr-namespace:TelegramClient.Converters"
    xmlns:media="clr-namespace:TelegramClient.Views.Media">

    <ResourceDictionary.MergedDictionaries>
        <themes:SharedResourceDictionary Source="/TelegramClient.WP8;component/Themes/Default/W10MCommon.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <converters:TTLMediaToVisibilityConverter x:Key="TTLMediaToVisibilityConverter"/>
    <converters:TTLMediaToTimerStringConverter x:Key="TTLMediaToTimerStringConverter"/>

    <Style x:Key="ReplyCaptionStyle" TargetType="TextBlock">
        <Setter Property="Margin" Value="10,-6,0,0"/>
        <Setter Property="TextTrimming" Value="WordEllipsis"/>
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="Foreground" Value="{StaticResource TelegramAccentBrush}"/>
        <Setter Property="FontSize" Value="20"/>
        <Setter Property="MaxHeight" Value="27"/>
    </Style>

    <Style x:Key="ReplyBodyStyle" TargetType="TextBlock">
        <Setter Property="Margin" Value="10,0,0,0"/>
        <Setter Property="TextTrimming" Value="WordEllipsis"/>
        <Setter Property="TextWrapping" Value="NoWrap"/>
        <Setter Property="FontSize" Value="20"/>
        <Setter Property="MaxHeight" Value="27"/>
    </Style>

    <DataTemplate x:Key="GroupTemplate">
        <Grid Margin="-11,-5,-11,1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <controls:GroupedMessageControl
                Media="{Binding}">
            </controls:GroupedMessageControl>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="InvoiceTemplate">
        <Grid Margin="-10,3,-10,1" Width="323">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <!--<Border Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>-->
            <Grid Grid.Column="1" >
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0" Background="Transparent">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="OpenInvoice">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Margin="12,-2,12,0" Grid.Row="0" TextWrapping="NoWrap" Text="{Binding Title}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                    <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="1" Text="{Binding Description}" Visibility="{Binding DescriptionVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />
                    <TextBlock Margin="12,-2,12,0" Grid.Row="2" TextWrapping="NoWrap" Text="{Binding Self, Converter={StaticResource InvoiceToDescriptionConverter}}" TextTrimming="WordEllipsis" Opacity="0.6" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                </Grid>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="InvoicePhotoTemplate">
        <Grid Margin="-10,3,-10,1" Width="323">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <!--<Border Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>-->
            <Grid Grid.Column="1" >
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0" Background="Transparent">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="OpenInvoice">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Margin="12,-2,12,0" Grid.Row="0" TextWrapping="NoWrap" Text="{Binding Title}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                    <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="2" Text="{Binding Description}" Visibility="{Binding DescriptionVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />
                </Grid>
                <Grid Margin="0,6,0,0" Grid.Row="1" Background="Transparent"
                      Width="{Binding ConverterParameter=Width, Converter={StaticResource InvoiceToDimensionConverter}}"
			          Height="{Binding ConverterParameter=Height, Converter={StaticResource InvoiceToDimensionConverter}}" MaxHeight="250">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="OpenInvoice">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                    <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                    <Image Source="{Binding Photo.Uri}" Stretch="UniformToFill"/>

                    <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="12" IsHitTestVisible="False">
                        <Border Margin="-3" Background="{StaticResource PhoneBackgroundBrush}" Opacity="0.5"/>
                        <TextBlock Margin="3,-2,3,0" TextAlignment="Center" FontSize="{StaticResource PhoneFontSizeSmall}" Text="{Binding Converter={StaticResource InvoiceToDescriptionConverter}}" Foreground="{StaticResource PhoneForegroundBrush}" FontFamily="{StaticResource PhoneFontFamilySemiLight}"/>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="StickerTemplate">
        <Image Margin="-6,0"
            Stretch="Fill" 
            Source="{Binding Document, Converter={StaticResource DefaultPhotoConverter}}"
            Height="{Binding Document, Converter={StaticResource StickerToDimensionConverter}, ConverterParameter=Height}"
            Width="{Binding Document, Converter={StaticResource StickerToDimensionConverter}, ConverterParameter=Width}"/>
    </DataTemplate>

    <DataTemplate x:Key="GameGifTemplate">
        <Grid Margin="0,0,0,0" Width="311">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" >
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0" Background="Transparent">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="OpenGame">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Margin="12,-2,0,0" Grid.Row="0" TextWrapping="NoWrap" Text="{Binding Game.Title}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                    <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="1" emojiPanel:BrowserNavigationService.Message="{Binding SourceMessage}" Text="{Binding Message}" Visibility="{Binding MessageVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />
                    <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="2" Text="{Binding Game.Description}" Visibility="{Binding DescriptionVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />
                </Grid>
                <Grid Grid.Row="1" Margin="12,6,0,0">
                    <additional:GifPlayerControl
                        Width="{Binding Game.Document, ConverterParameter=Width, Converter={StaticResource WebPageGifToDimensionConverter}}" 
                        Height="{Binding Game.Document, ConverterParameter=Height, Converter={StaticResource WebPageGifToDimensionConverter}}"
                        Media="{Binding ThumbSelf}"
                        Progress="{Binding DownloadingProgress}"
                        micro:Message.Attach="[Event CancelDownload] = [Action CancelDocumentDownloading($DataContext)]"/>

                    <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="12" IsHitTestVisible="False">
                        <Border Margin="-3" Background="{StaticResource PhoneBackgroundBrush}" Opacity="0.5"/>
                        <TextBlock Margin="3,-2,3,0" TextAlignment="Center" FontSize="{StaticResource PhoneFontSizeSmall}" Text="{Binding Resources.Game, Source={StaticResource Strings}, Converter={StaticResource Uppercase}}" Foreground="{StaticResource PhoneForegroundBrush}" FontFamily="{StaticResource PhoneFontFamilySemiLight}"/>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="GameTemplate">
        <Grid Margin="0,0,0,0" Width="311">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" >
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0" Background="Transparent">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="OpenGame">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Margin="12,-2,0,0" Grid.Row="0" TextWrapping="NoWrap" Text="{Binding Game.Title}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                    <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="1" emojiPanel:BrowserNavigationService.Message="{Binding SourceMessage}" Text="{Binding Message}" Visibility="{Binding MessageVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />
                    <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="2" Text="{Binding Game.Description}" Visibility="{Binding DescriptionVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />
                </Grid>
                <Grid Margin="12,6,0,0" Grid.Row="1" Background="Transparent"
                      Width="{Binding ConverterParameter=Width, Converter={StaticResource GameToDimensionConverter}}"
			          Height="{Binding ConverterParameter=Height, Converter={StaticResource GameToDimensionConverter}}" MaxHeight="250">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="OpenGame">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                    <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                    <Image Source="{Binding Self, Converter={StaticResource DefaultPhotoConverter}, ConverterParameter=90}" Stretch="UniformToFill"/>
                    <Image Source="{Binding Self, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill"/>

                    <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="12" IsHitTestVisible="False">
                        <Border Margin="-3" Background="{StaticResource PhoneBackgroundBrush}" Opacity="0.5"/>
                        <TextBlock Margin="3,-2,3,0" TextAlignment="Center" FontSize="{StaticResource PhoneFontSizeSmall}" Text="{Binding Resources.Game, Source={StaticResource Strings}, Converter={StaticResource Uppercase}}" Foreground="{StaticResource PhoneForegroundBrush}" FontFamily="{StaticResource PhoneFontFamilySemiLight}"/>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPageGifMediaTemplate">
        <Grid Width="311" Margin="0,3,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Border Width="4" Grid.RowSpan="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Margin="12,-2,0,0" Grid.Column="1" Grid.Row="0" Text="{Binding WebPage.SiteName}" Visibility="{Binding WebPage.SiteNameVisibility}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
            <TextBlock Margin="12,-2,0,0" Grid.Column="1" Grid.Row="2" Text="{Binding WebPage.Title}" Visibility="{Binding WebPage.TitleVisibility}" TextTrimming="WordEllipsis" TextWrapping="Wrap" FontFamily="{StaticResource PhoneFontFamilySemiBold}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
            <additional:GifPlayerControl  
                Grid.Column="1" Grid.Row="3" Margin="12,0,0,0"
                Width="{Binding WebPage.Document, ConverterParameter=Width, Converter={StaticResource WebPageGifToDimensionConverter}}" 
                Height="{Binding WebPage.Document, ConverterParameter=Height, Converter={StaticResource WebPageGifToDimensionConverter}}"
                Media="{Binding ThumbSelf}"
                Progress="{Binding DownloadingProgress}"
                micro:Message.Attach="[Event CancelDownload] = [Action CancelDocumentDownloading($DataContext)]"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPageSmallPhotoMediaTemplate">
        <Grid Margin="0,3,0,1" Width="311">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width ="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid Width="50" Height="50" Margin="8,0,0,0" Grid.Column="1" Grid.Row="1" Grid.RowSpan="4" VerticalAlignment="Top">
                    <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                    <Image Source="{Binding Self, Converter={StaticResource DefaultPhotoConverter}}" HorizontalAlignment="Center" Stretch="UniformToFill"/>
                </Grid>
                <TextBlock Margin="12,-2,0,0" Grid.Column="0" Grid.Row="0" Text="{Binding WebPage.SiteName}" Visibility="{Binding WebPage.SiteNameVisibility}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <TextBlock Margin="12,-2,0,0" Grid.Column="0" Grid.Row="1" Text="{Binding WebPage.Author}" Visibility="{Binding WebPage.AuthorVisibility}" TextTrimming="WordEllipsis" TextWrapping="Wrap" FontFamily="{StaticResource PhoneFontFamilySemiBold}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <TextBlock Margin="12,-2,0,0" Grid.Column="0" Grid.Row="2" Text="{Binding WebPage.Title}" Visibility="{Binding WebPage.TitleVisibility}" TextTrimming="WordEllipsis" TextWrapping="Wrap" FontFamily="{StaticResource PhoneFontFamilySemiBold}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Column="0" Grid.Row="3" Text="{Binding WebPage.Description}" Visibility="{Binding WebPage.DescriptionVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPagePhotoMediaTemplate">
        <Grid Margin="0,3,0,1" Width="311">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" >
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Margin="12,-2,0,0" Grid.Row="0" TextWrapping="NoWrap" Text="{Binding WebPage.SiteName}" Visibility="{Binding WebPage.SiteNameVisibility}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <TextBlock Margin="12,-2,0,0" Grid.Row="1" TextWrapping="NoWrap" Text="{Binding WebPage.Author}" Visibility="{Binding WebPage.AuthorVisibility}" TextTrimming="WordEllipsis" FontFamily="{StaticResource PhoneFontFamilySemiBold}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <TextBlock Margin="12,-2,0,0" Grid.Row="2" TextWrapping="Wrap" Text="{Binding WebPage.Title}" Visibility="{Binding WebPage.TitleVisibility}" TextTrimming="WordEllipsis" FontFamily="{StaticResource PhoneFontFamilySemiBold}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="3" Text="{Binding WebPage.Description}" Visibility="{Binding WebPage.DescriptionVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}" />

                <Grid Margin="12,6,0,0" Grid.Row="4" Width="{Binding ConverterParameter=Width, Converter={StaticResource WebPageToDimensionConverter}}"
			        Height="{Binding ConverterParameter=Height, Converter={StaticResource WebPageToDimensionConverter}}" MaxHeight="250">
                    <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                    <Image Source="{Binding Self, Converter={StaticResource DefaultPhotoConverter}, ConverterParameter=90}" Stretch="UniformToFill"/>
                    <Image Source="{Binding Self, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill"/>

                    <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Visibility="{Binding WebPage.Type, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=video}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Image VerticalAlignment="Center"
					        Width="48" Height="48" Margin="-4,3,-4,0"
					        Source="/Images/Audio/appbar.transport.play.rest.png"/>
                        <TextBlock Grid.Column="1"
					        VerticalAlignment="Center" Margin="0"
					        Text="{Binding WebPage.DurationString}"
					        Foreground="White"
					        Style="{StaticResource PhoneTextLargeStyle}"/>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPageMediaTemplate">
        <Grid Margin="0,3,0,0" Width="311">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" >
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Margin="12,-2,0,0" Text="{Binding WebPage.SiteName}" Visibility="{Binding WebPage.SiteNameVisibility}" TextTrimming="WordEllipsis" Foreground="{StaticResource TelegramTextAccentBrush}" FontWeight="SemiBold" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <TextBlock Margin="12,-2,0,0" Grid.Row="1" TextWrapping="Wrap" Text="{Binding WebPage.Author}" Visibility="{Binding WebPage.AuthorVisibility}" TextTrimming="WordEllipsis" FontFamily="{StaticResource PhoneFontFamilySemiBold}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <TextBlock Margin="12,-2,0,0" Grid.Row="2" TextWrapping="Wrap" Text="{Binding WebPage.Title}" Visibility="{Binding WebPage.TitleVisibility}" TextTrimming="WordEllipsis" FontFamily="{StaticResource PhoneFontFamilySemiBold}" FontSize="{StaticResource PhoneFontSizeSmall}"/>
                <emojiPanel:TelegramRichTextBox Margin="0,-2,0,0" Grid.Row="3" Text="{Binding WebPage.Description}" Visibility="{Binding WebPage.DescriptionVisibility}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" FontSize="{StaticResource PhoneFontSizeSmall}"/>

            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPagePendingMediaTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="46" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" >
                <TextBlock Margin="12,-2,0,0" VerticalAlignment="Center" TextWrapping="NoWrap" Text="{Binding Resources.GettingLinkInfo, Source={StaticResource Strings}}" TextTrimming="WordEllipsis" Foreground="White" FontFamily="{StaticResource PhoneFontFamilySemiLight}" Style="{StaticResource PhoneTextSmallStyle}"/>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="MediaEmptyTemplate"/>

    <DataTemplate x:Key="ContactTemplate">
        <Grid Margin="0,6" MaxWidth="311">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <views:ConversationTileControl Size="64" 
                Margin="0" Grid.RowSpan="2" VerticalAlignment="Top"
                Source="{Binding User.Photo, Converter={StaticResource DefaultPhotoConverter}}"
                Fill="{Binding User.Index, Converter={StaticResource PlaceholderBackgroundConverter}}"
                Text="{Binding User, Converter={StaticResource PlaceholderDefaultTextConverter}}"/>

            <TextBlock Grid.Column="1" Grid.Row="0" Margin="16,0,0,0" TextWrapping="NoWrap" TextTrimming="WordEllipsis" VerticalAlignment="Bottom" Text="{Binding}" FontWeight="SemiBold" FontSize="20" MaxHeight="27"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Margin="16,0,0,0" TextWrapping="NoWrap" TextTrimming="WordEllipsis" VerticalAlignment="Top" Text="{Binding PhoneNumber, Converter={StaticResource SimplePhoneNumberConverter}}" Opacity="0.6" FontSize="20"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PhoneContactTemplate">
        <Grid Margin="0,6" Width="311">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <views:ConversationTileControl Size="64" 
                Margin="0" Grid.RowSpan="2" VerticalAlignment="Top"
                Source="{Binding User.Photo, Converter={StaticResource DefaultPhotoConverter}}"
                Fill="{Binding User.Index, Converter={StaticResource PlaceholderBackgroundConverter}}"
                Text="{Binding User, Converter={StaticResource PlaceholderDefaultTextConverter}}"/>

            <TextBlock Grid.Column="1" Grid.Row="0" Margin="16,0,0,0" TextWrapping="NoWrap" TextTrimming="WordEllipsis" VerticalAlignment="Bottom" Text="{Binding}" FontWeight="SemiBold" FontSize="20" MaxHeight="27"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Margin="16,0,0,0" TextWrapping="NoWrap" TextTrimming="WordEllipsis" VerticalAlignment="Top" Text="{Binding PhoneNumber, Converter={StaticResource SimplePhoneNumberConverter}}" Opacity="0.6" FontSize="20"/>

            <Button Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2" FontSize="17.774" BorderThickness="1" Content="{Binding Resources.ViewContact, Source={StaticResource Strings}, Converter={StaticResource Uppercase}}" Margin="-12,0,-12,-12"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="CallTemplate">
        <Grid Margin="0,0,0,6" Width="284" Background="Transparent">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Column="0" Grid.Row="0" Margin="0,0,18,0" TextTrimming="WordEllipsis" Text="{Binding Converter={StaticResource PhoneCallToTitleConverter}}" FontWeight="SemiBold" FontSize="20"/>
                <TextBlock Grid.Column="0" Grid.Row="1" Margin="0,0,18,0" Text="{Binding Converter={StaticResource PhoneCallToSubtitleConverter}}" TextTrimming="WordEllipsis" Opacity="0.6" FontSize="20"/>

                <Image
                    Grid.Column="1"
                    Grid.RowSpan="2"
                    Margin="0"
                    Width="40" Height="40"
                    Source="/Images/W10M/ic_call_answer_blue_2x.png"/>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="DocumentTemplate">
        <Grid Margin="0,6,0,12" Width="{Binding ConverterParameter=Width, Converter={StaticResource DocumentToDimensionConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <dialogs:DocumentTileControl 
                    Grid.RowSpan="2" 
                    Width="64" Height="64"
                    DownloadIconVisibility="{Binding Self, Converter={StaticResource DownloadMediaToVisibilityConverter}}"
                    Text="{Binding Document.FileExt, Converter={StaticResource Lowercase}}"
                    Source="{Binding Document, Converter={StaticResource DefaultPhotoConverter}}"
                    Music="{Binding Document.Music}"
                    DownloadingProgress="{Binding DownloadingProgress}"
                    UploadingProgress="{Binding UploadingProgress}"/>

                <TextBlock Grid.Column="1" Grid.Row="0" Margin="18,0,6,0" TextTrimming="WordEllipsis" Text="{Binding Document.DocumentName, Converter={StaticResource NonBreakingStringConverter}}" FontWeight="SemiBold" FontSize="20"/>
                <TextBlock Grid.Row="1" Grid.Column="1" Margin="18,0,6,0" Text="{Binding Document.Size.Value, Converter={StaticResource FileSizeConverter}}" Opacity="0.6" FontSize="20"/>

                <Grid Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Grid.ColumnSpan="2" Background="Transparent"
				    Visibility="{Binding DownloadingProgress, Converter={StaticResource ProgressToVisibilityConverter}}">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="CancelDocumentDownloading">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                </Grid>

                <Grid Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Grid.ColumnSpan="2" Background="Transparent"
				    Visibility="{Binding UploadingProgress, Converter={StaticResource ProgressToVisibilityConverter}}">
                    <i:Interaction.Triggers>
                        <behaviors:HandledEventTrigger EventName="Tap">
                            <micro:ActionMessage MethodName="CancelUploading">
                                <micro:ActionMessage.Parameters>
                                    <micro:Parameter Value="{Binding}"/>
                                </micro:ActionMessage.Parameters>
                            </micro:ActionMessage>
                        </behaviors:HandledEventTrigger>
                    </i:Interaction.Triggers>
                </Grid>
            </Grid>

            <emojiPanel:TelegramRichTextBox
                Grid.Row="1"
                MaxWidth="335"
                Margin="-6,0"
                MaxHeight="400"
                Visibility="{Binding Caption, Converter={StaticResource EmptyTLStringToVisibilityConverter}, ConverterParameter=invert, FallbackValue=Collapsed}"
                Text="{Binding Caption}"
                HorizontalAlignment="Stretch"
                Background="{Binding Converter={StaticResource OverlayAccentBrush}}"
                TextScaleFactor="{Binding TextScaleFactor, Source={StaticResource ScaledText}}"
                FontSize="{Binding DefaultFontSize, Source={StaticResource ScaledText}}"
                Style="{StaticResource MessageBodyTelegramRichTextStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="GifTemplate">
        <Grid Margin="-10,-4,-10,2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <additional:GifPlayerControl
                Width="{Binding Document, ConverterParameter=Width, Converter={StaticResource GifToDimensionConverter}}"
                Height="{Binding Document, ConverterParameter=Height, Converter={StaticResource GifToDimensionConverter}}"
                Media="{Binding ThumbSelf}"
                Progress="{Binding DownloadingProgress}"
                UploadingProgress="{Binding UploadingProgress}"
                micro:Message.Attach="[Event CancelDownload] = [Action CancelDocumentDownloading($DataContext)]"/>

            <!--<TextBlock Text="{Binding UploadingProgress}"/>-->
            <emojiPanel:TelegramRichTextBox
                Grid.Row="1"
                Width="335"
                Margin="-6,0"
                MaxHeight="400"
                Visibility="{Binding Caption, Converter={StaticResource EmptyTLStringToVisibilityConverter}, ConverterParameter=invert, FallbackValue=Collapsed}"
                Text="{Binding Caption}"
                HorizontalAlignment="Stretch"
                Background="{Binding Converter={StaticResource OverlayAccentBrush}}"
                TextScaleFactor="{Binding TextScaleFactor, Source={StaticResource ScaledText}}"
                FontSize="{Binding DefaultFontSize, Source={StaticResource ScaledText}}"
                Style="{StaticResource MessageBodyTelegramRichTextStyle}"/>

            <!--<controls:Progress Value="{Binding DownloadingProgress}" CancelVisibility="Collapsed" Width="48" Height="48" HorizontalAlignment="Center" VerticalAlignment="Center"/>-->
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="AudioTemplate">
        <Grid Margin="0,6,0,12" Width="284">
            <controls:MessagePlayerControl 
                ManipulationStarted="HandledManipulationStarted"
                Margin="0,0,0,1" 
                Media="{Binding ThumbSelf}"
                Waveform="{Binding Waveform}"
                Progress="{Binding DownloadingProgress}"
                UploadingProgress="{Binding UploadingProgress}"
                NotListened="{Binding NotListened}"
                micro:Message.Attach="[Event CancelDownload] = [Action CancelAudioDownloading($DataContext)]"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="SecretPhotoTemplate">
        <Grid Margin="-10,-4,-10,2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Width="256" Height="256">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="1" Width="256" Height="256" Background="#66000000">
                    <Image Source="{Binding Self, Converter={StaticResource ForcePhotoConverter}}" Opacity="0" Stretch="UniformToFill" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="1"/>
                    <Image Source="{Binding ThumbSelf, Converter={StaticResource SecretPhotoToThumbConverter}}" Stretch="UniformToFill" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    <controls:SecretPhotoPlaceholder
                        Width="256" Height="256" 
                        ShowHint="False"
                        TTLParams="{Binding TTLParams}"
                        DownloadingProgress="{Binding DownloadingProgress}"
                        UploadingProgress="{Binding UploadingProgress}"
                        micro:Message.Attach="[Event CancelUploading] = [Action CancelUploading($DataContext)]; [Event CancelDownloading] = [Action CancelPhotoDownloading($DataContext)]"/>

                    <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="4" Background="#7F000000">
                        <TextBlock Margin="6,1,6,2"
					        Text="{Binding TTLSeconds, Converter={StaticResource TTLMediaToTimerStringConverter}}"
					        Foreground="White"
					        FontSize="{Binding DefaultSystemFontSize, Source={StaticResource ScaledText}}"/>
                    </Grid>
                </Grid>
            </Grid>

            <emojiPanel:TelegramRichTextBox
                    Grid.Row="1"
                    Width="256"
                    Margin="-6,0"
                    MaxHeight="400"
                    Visibility="{Binding Caption, Converter={StaticResource EmptyTLStringToVisibilityConverter}, ConverterParameter=invert, FallbackValue=Collapsed}"
                    Text="{Binding Caption}"
                    HorizontalAlignment="Stretch"
                    Background="{Binding Converter={StaticResource OverlayAccentBrush}}"
                    TextScaleFactor="{Binding TextScaleFactor, Source={StaticResource ScaledText}}"
                    FontSize="{Binding DefaultFontSize, Source={StaticResource ScaledText}}"
                    Style="{StaticResource MessageBodyTelegramRichTextStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PhotoTemplate">
        <Grid Margin="-10,-4,-10,2" Width="{Binding ConverterParameter=Width, Converter={StaticResource PhotoToDimensionConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <controls:MediaPhotoControl
                Height="{Binding ConverterParameter=Height, Converter={StaticResource PhotoToDimensionConverter}}"
                Media="{Binding}"
                Source="{Binding Self, Converter={StaticResource DefaultPhotoConverter}}"
                PreviewSource="{Binding ThumbSelf, Converter={StaticResource PhotoToThumbConverter}}"              
                DownloadingProgress="{Binding DownloadingProgress}"
                UploadingProgress="{Binding UploadingProgress}"
                micro:Message.Attach="[Event CancelUploading] = [Action CancelUploading($DataContext)]; [Event CancelDownloading] = [Action CancelPhotoDownloading($DataContext)]">
            </controls:MediaPhotoControl>

            <emojiPanel:TelegramRichTextBox
                Grid.Row="1"
                Margin="-6,0"
                MaxHeight="400"
                Visibility="{Binding Caption, Converter={StaticResource EmptyTLStringToVisibilityConverter}, ConverterParameter=invert, FallbackValue=Collapsed}"
                Text="{Binding Caption}"
                HorizontalAlignment="Stretch"
                Background="{Binding Converter={StaticResource OverlayAccentBrush}}"
                TextScaleFactor="{Binding TextScaleFactor, Source={StaticResource ScaledText}}"
                FontSize="{Binding DefaultFontSize, Source={StaticResource ScaledText}}"
                Style="{StaticResource MessageBodyTelegramRichTextStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="SecretVideoTemplate">
        <Grid Margin="-10,-4,-10,2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Width="256" Height="256" Background="#66000000">
                <Image Source="{Binding ThumbSelf, Converter={StaticResource SecretPhotoToThumbConverter}}" Stretch="UniformToFill" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <controls:SecretPhotoPlaceholder
                        Width="256" Height="256" 
                        ShowHint="False"
                        TTLParams="{Binding TTLParams}"
                        UploadingProgress="{Binding UploadingProgress}"
                        DownloadingProgress="{Binding DownloadingProgress}"
                        micro:Message.Attach="[Event CancelUploading] = [Action CancelUploading($DataContext)]; [Event CancelDownloading] = [Action CancelVideoDownloading($DataContext)]"/>

                <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="4" Background="#7F000000">
                    <TextBlock Margin="6,1,6,2"
					        Text="{Binding TTLSeconds, Converter={StaticResource TTLMediaToTimerStringConverter}}"
					        Foreground="White"
					        FontSize="{Binding DefaultSystemFontSize, Source={StaticResource ScaledText}}"/>
                </Grid>
            </Grid>

            <emojiPanel:TelegramRichTextBox
                    Grid.Row="1"
                    Width="256"
                    Margin="-6,0"
                    MaxHeight="400"
                    Visibility="{Binding Caption, Converter={StaticResource EmptyTLStringToVisibilityConverter}, ConverterParameter=invert, FallbackValue=Collapsed}"
                    Text="{Binding Caption}"
                    HorizontalAlignment="Stretch"
                    Background="{Binding Converter={StaticResource OverlayAccentBrush}}"
                    TextScaleFactor="{Binding TextScaleFactor, Source={StaticResource ScaledText}}"
                    FontSize="{Binding DefaultFontSize, Source={StaticResource ScaledText}}"
                    Style="{StaticResource MessageBodyTelegramRichTextStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="VideoTemplate">
        <Grid Margin="-10,-4,-10,2" >
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <controls:MediaVideoControl
                Width="230" Height="154"
                Source="{Binding ThumbSelf, Converter={StaticResource PhotoToThumbConverter}}"
                DownloadIconVisibility="{Binding Self, Converter={StaticResource DownloadMediaToVisibilityConverter}}"
                DownloadingProgress="{Binding DownloadingProgress}"
                UploadingProgress="{Binding UploadingProgress}"
                micro:Message.Attach="[Event CancelUploading] = [Action CancelUploading($DataContext)]; [Event CancelDownloading] = [Action CancelVideoDownloading($DataContext)]"/>

            <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="4" Background="#7F000000" IsHitTestVisible="False">
                <StackPanel Margin="6,1,6,2" Orientation="Horizontal">
                    <TextBlock
					        Text="{Binding Video.DurationString}"
					        Foreground="White"
					        FontSize="{Binding DefaultSystemFontSize, Source={StaticResource ScaledText}}"/>
                    <TextBlock 
                            Text="{Binding Video.Size.Value, Converter={StaticResource FileSizeConverter}, StringFormat=', \{0\}'}"
                            Foreground="White" 
					        FontSize="{Binding DefaultSystemFontSize, Source={StaticResource ScaledText}}"/>
                    <TextBlock Visibility="{Binding CompressingProgress, Converter={StaticResource ProgressToVisibilityConverter}}"
                            Text="{Binding CompressingProgress, StringFormat=', \{0:P\}'}"
                            Foreground="White" 
					        FontSize="{Binding DefaultSystemFontSize, Source={StaticResource ScaledText}}"/>
                </StackPanel>
            </Grid>

            <emojiPanel:TelegramRichTextBox
                Grid.Row="1"
                Width="230"
                Margin="-6,0"
                MaxHeight="400"
                Visibility="{Binding Caption, Converter={StaticResource EmptyTLStringToVisibilityConverter}, ConverterParameter=invert, FallbackValue=Collapsed}"
                Text="{Binding Caption}"
                HorizontalAlignment="Stretch"
                Background="{Binding Converter={StaticResource OverlayAccentBrush}}"
                TextScaleFactor="{Binding TextScaleFactor, Source={StaticResource ScaledText}}"
                FontSize="{Binding DefaultFontSize, Source={StaticResource ScaledText}}"
                Style="{StaticResource MessageBodyTelegramRichTextStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="RoundVideoTemplate">
        <Grid Margin="-10,-4,-10,2" >
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <additional:GifPlayerControl
                Mode="RoundVideo"
                Width="240"
                Height="240"
                Media="{Binding ThumbSelf}"
                Progress="{Binding DownloadingProgress}"
                UploadingProgress="{Binding UploadingProgress}"
                micro:Message.Attach="[Event CancelDownload] = [Action CancelDocumentDownloading($DataContext)]">
                <additional:GifPlayerControl.FrameClip>
                    <EllipseGeometry x:Name="ImageClipGeometry" Center="120,120" RadiusX="120" RadiusY="120"/>
                </additional:GifPlayerControl.FrameClip>
            </additional:GifPlayerControl>

            <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="4" Background="#49496A95">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Margin="6,-1,6,2"
					    Text="{Binding Video.DurationString}"
					    Foreground="White"
					    FontSize="18"/>
                <Ellipse x:Name="NotListenedIndicator" Visibility="{Binding NotListened, Converter={StaticResource BooleanToVisibilityConverter}}" Grid.Column="1" Margin="0,1,6,2" Width="8" Height="8" Fill="White"/>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="LiveGeoPointTemplate">
        <Grid Width="320" Margin="-10,-4,-10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid Width="320" Height="188" Margin="0,0,0,2">
                <Border Background="Black" Opacity="0.4"/>
                <media:StaticMapControl Source="{Binding Self, Converter={StaticResource GeoPointToStaticGoogleMapsConverter3}}" ManipulationStarted="HandledManipulationStarted"/>

                <Grid VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Grid.RenderTransform>
                        <TranslateTransform Y="-40"/>
                    </Grid.RenderTransform>
                    <Border Width="76" Height="76" CornerRadius="38" Background="#33000000">
                        <Border.RenderTransform>
                            <CompositeTransform TranslateY="1" TranslateX="1"/>
                        </Border.RenderTransform>
                    </Border>
                    <Border Width="36" Height="36" Background="#33000000" RenderTransformOrigin="0.5,0.5">
                        <Border.RenderTransform>
                            <CompositeTransform TranslateY="21" TranslateX="0.5" Rotation="45"/>
                        </Border.RenderTransform>
                    </Border>

                    <Border Background="#33000000" Width="12" Height="12" CornerRadius="6">
                        <Border.RenderTransform>
                            <CompositeTransform TranslateY="53" TranslateX="1" />
                        </Border.RenderTransform>
                    </Border>

                    <Border Background="White" Width="76" Height="76" CornerRadius="38"/>
                    <Border Width="36" Height="36" Background="White" RenderTransformOrigin="0.5,0.5">
                        <Border.RenderTransform>
                            <CompositeTransform TranslateY="20" Rotation="45"/>
                        </Border.RenderTransform>
                    </Border>
                    <views:ConversationTileControl Size="72"
                        Margin="3" Grid.RowSpan="2"
                        Source="{Binding From.Photo, Converter={StaticResource DefaultPhotoConverter}}"
                        Fill="{Binding From.Index, Converter={StaticResource PlaceholderBackgroundConverter}}"
                        Text="{Binding From, Converter={StaticResource PlaceholderDefaultTextConverter}}"/>

                    <Border BorderThickness="2" BorderBrush="White" Background="{StaticResource TelegramBadgeAccentBrush}" Width="12" Height="12" CornerRadius="6">
                        <Border.RenderTransform>
                            <CompositeTransform TranslateY="52" />
                        </Border.RenderTransform>
                    </Border>
                </Grid>
            </Grid>

            <Grid Grid.Row="1" Margin="10,10,10,12" Visibility="{Binding Active, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!--<Border Grid.Column="0" Grid.RowSpan="2" Background="#FFFF6464" CornerRadius="32" Width="64" Height="64">
                    <Image Height="26" HorizontalAlignment="Center" VerticalAlignment="Center" Source="/Images/W10M/ic_livelocation_2x.png"/>
                </Border>-->

                <Grid Grid.Column="0" VerticalAlignment="Center">
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Column="1" Grid.Row="0" Margin="0,-4,0,0" Text="{Binding Resources.LiveLocation, Source={StaticResource Strings}}" FontWeight="SemiBold" FontSize="20"/>
                    <TextBlock Grid.Column="1" Grid.Row="1" Margin="0,0,0,0" Text="{Binding EditDate, Converter={StaticResource EditDateToStringConverter}}" Opacity="0.6" FontSize="20"/>
                </Grid>

                <controls:LiveLocationProgress 
                    Grid.Column="1"
                    Media="{Binding }"
                    micro:Message.Attach="[Event Completed] = [Action LiveLocationCompleted($DataContext)]">

                </controls:LiveLocationProgress>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="GeoPointTemplate">
        <Grid Margin="-10,-4,-10,2" Width="320" Height="188">
            <Border Background="Black" Opacity="0.4"/>

            <media:StaticMapControl Source="{Binding Self, Converter={StaticResource GeoPointToStaticGoogleMapsConverter3}}" ManipulationStarted="HandledManipulationStarted"/>
            
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                <Grid.RenderTransform>
                    <TranslateTransform X="0" Y="-20"/>
                </Grid.RenderTransform>
                <Path Fill="#60B0E8" Data="M14,0 C6.26,0 0,6.26 0,14 C0,24.5 14,40 14,40 C14,40 28,24.5 28,14 C28,6.26 21.74,0 14,0 L14,0 Z M14,19 C11.24,19 9,16.76 9,14 C9,11.24 11.24,9 14,9 C16.76,9 19,11.24 19,14 C19,16.76 16.76,19 14,19 L14,19 Z"/>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="VenueTemplate">
        <Grid Width="320" Margin="-10,-4,-10,2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid Width="96" Height="96" Margin="0">
                <Border Background="Black" Opacity="0.4"/>

                <media:StaticMapControl Source="{Binding Self, Converter={StaticResource VenueToStaticGoogleMapsConverter2}}" ManipulationStarted="HandledManipulationStarted"/>
                
                <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Grid.RenderTransform>
                        <TranslateTransform X="0" Y="-20"/>
                    </Grid.RenderTransform>
                    <Path Fill="#60B0E8" Data="M14,0 C6.26,0 0,6.26 0,14 C0,24.5 14,40 14,40 C14,40 28,24.5 28,14 C28,6.26 21.74,0 14,0 L14,0 Z M14,19 C11.24,19 9,16.76 9,14 C9,11.24 11.24,9 14,9 C16.76,9 19,11.24 19,14 C19,16.76 16.76,19 14,19 L14,19 Z"/>
                </Grid>
            </Grid>

            <Grid Grid.Column="1" Margin="0,-2,0,0"  VerticalAlignment="Center">
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <TextBlock Margin="12,0" TextTrimming="WordEllipsis" Text="{Binding Title}" FontWeight="SemiBold" FontSize="20"/>
                <TextBlock Grid.Row="1" Margin="12,0" Text="{Binding Address}" Visibility="{Binding Address, Converter={StaticResource EmptyTLStringToVisibilityConverter}, ConverterParameter=invert}" TextWrapping="NoWrap" TextTrimming="WordEllipsis" Opacity="0.6" FontSize="20"/>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="UnsupportedTemplate">
        <emojiPanel:TelegramRichTextBox 
            Margin="-12,0,-12,0"
            Width="335"
            Text="{Binding Resources.UnsupportedMedia, Source={StaticResource Strings}}"
            HorizontalAlignment="Stretch"
            TextScaleFactor="{Binding TextScaleFactor, Source={StaticResource ScaledText}}"
            FontSize="{Binding DefaultFontSize, Source={StaticResource ScaledText}}"
            Style="{StaticResource MessageBodyTelegramRichTextStyle}"/>
    </DataTemplate>

    <DataTemplate x:Key="ReplyServiceTextTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Converter={StaticResource ServiceMessageToTextConverter}, ConverterParameter='nolinksnouser'}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyServicePhotoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Action.Photo, Converter={StaticResource DefaultPhotoConverter}, ConverterParameter=100}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Converter={StaticResource ServiceMessageToTextConverter}, ConverterParameter='nolinksnouser'}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedEmptyTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.EmptyMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyEmptyTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.EmptyMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardEmptyTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.EmptyMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedUnsupportedTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.Unsupported, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyUnsupportedTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.Unsupported, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditUnsupportedTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.Unsupported, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardUnsupportedTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.Unsupported, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyLoadingTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.Loading, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPageEmptyTemplate">
        <Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPageTemplate">
        <Grid Margin="0,3,0,1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding WebPageMedia.WebPage, Converter={StaticResource WebPageToCaptionConverter}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding WebPageMedia.WebPage, Converter={StaticResource WebPageToDescriptionConverter}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="WebPagePendingTemplate">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Width="4" Margin="0" BorderThickness="0" Height="48" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Resources.GettingLinkInfo, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardedMessagesTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Converter={StaticResource MessageContainerToFromConverter}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Converter={StaticResource MessageContainerToContentConverter}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyWebPageTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Media.Url}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedTextTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Message}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyTextTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Message}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditTextTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Message}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardTextTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Message}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedInvoiceTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media.Description}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyInvoiceTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media.Description}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardInvoiceTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media.Description}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplySecretPhotoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Photo, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedGameTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.ThumbSelf, Converter={StaticResource PhotoToThumbConverter}, ConverterParameter=noblur}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media.Game.Title}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyGameTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.ThumbSelf, Converter={StaticResource PhotoToThumbConverter}, ConverterParameter=noblur}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media.Game.Title}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardGameTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.ThumbSelf, Converter={StaticResource PhotoToThumbConverter}, ConverterParameter=noblur}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media.Game.Title}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedPhotoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.ThumbSelf, Converter={StaticResource PhotoToThumbConverter}, ConverterParameter=noblur}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Photo, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyPhotoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.ThumbSelf, Converter={StaticResource PhotoToThumbConverter}, ConverterParameter=noblur}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Photo, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditPhotoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.ThumbSelf, Converter={StaticResource PhotoToThumbConverter}, ConverterParameter=noblur}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="3" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.Photo, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardPhotoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.ThumbSelf, Converter={StaticResource PhotoToThumbConverter}, ConverterParameter=noblur}" Stretch="UniformToFill"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Photo, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill"/>
                <Image VerticalAlignment="Center" HorizontalAlignment="Center"
					    Width="48" Height="48"
					    Source="/Images/Audio/appbar.transport.play.rest.png"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Video, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedRoundVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4" CornerRadius="24"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill">
                    <Image.Clip>
                        <EllipseGeometry x:Name="ImageClipGeometry" Center="24,24" RadiusX="24" RadiusY="24"/>
                    </Image.Clip>
                </Image>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.VideoMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill"/>
                <Image VerticalAlignment="Center" HorizontalAlignment="Center"
					    Width="48" Height="48"
					    Source="/Images/Audio/appbar.transport.play.rest.png"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Video, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyRoundVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4" CornerRadius="24"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill">
                    <Image.Clip>
                        <EllipseGeometry x:Name="ImageClipGeometry" Center="24,24" RadiusX="24" RadiusY="24"/>
                    </Image.Clip>
                </Image>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.VideoMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill"/>
                <Image VerticalAlignment="Center" HorizontalAlignment="Center"
					    Width="48" Height="48"
					    Source="/Images/Audio/appbar.transport.play.rest.png"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="3" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.Video, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditRoundVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4" CornerRadius="24"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill">
                    <Image.Clip>
                        <EllipseGeometry x:Name="ImageClipGeometry" Center="24,24" RadiusX="24" RadiusY="24"/>
                    </Image.Clip>
                </Image>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="3" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.VideoMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill"/>
                <Image VerticalAlignment="Center" HorizontalAlignment="Center"
					    Width="48" Height="48"
					    Source="/Images/Audio/appbar.transport.play.rest.png"/>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Video, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardRoundVideoTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <Grid Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" VerticalAlignment="Bottom" Visibility="{Binding Media, Converter={StaticResource TTLMediaToVisibilityConverter}}">
                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="Black" Opacity="0.4" CornerRadius="24"/>
                <Image Source="{Binding Media.Video, Converter={StaticResource DefaultPhotoConverter}}" Stretch="UniformToFill">
                    <Image.Clip>
                        <EllipseGeometry x:Name="ImageClipGeometry" Center="24,24" RadiusX="24" RadiusY="24"/>
                    </Image.Clip>
                </Image>
            </Grid>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Video, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedContactTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Contact, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyContactTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Contact, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditContactTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.Contact, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardContactTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Contact, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedLiveGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.LiveLocation, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyLiveGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.LiveLocation, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditLiveGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="3" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.LiveLocation, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardLiveGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.LiveLocation, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.GeoPoint, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.GeoPoint, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="3" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.GeoPoint, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardGeoPointTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.GeoPoint, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedDocumentTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media, Converter={StaticResource FileNameConverter}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyDocumentTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media, Converter={StaticResource FileNameConverter}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditDocumentTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="3" Grid.Row="0" Margin="0,-2,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Media, Converter={StaticResource FileNameConverter}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardDocumentTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Media, Converter={StaticResource FileNameConverter}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedGifTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Gif, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyGifTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Gif, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditGifTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="3" Grid.Row="0" Margin="0,-2,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.Gif, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardGifTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <!--<Image Grid.Column="1" Grid.RowSpan="2" Width="48" Height="48" Margin="10,-6,0,0" Source="/Images/Messages/chat_doc-WXGA.png" Stretch="Uniform" VerticalAlignment="Bottom"/>-->
            <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding Resources.Gif, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedAudioTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Audio, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyAudioTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Audio, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditAudioTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.Audio, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardAudioTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Audio, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedVoiceMessageTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.VoiceMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyVoiceMessageTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.VoiceMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditVoiceMessageTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.VoiceMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardVoiceMessageTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.VoiceMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedStickerTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Sticker, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ReplyStickerTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Sticker, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="EditStickerTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.EditMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="2" Grid.Row="0" Margin="0,-6,0,0" Text="{Binding EditTimerString, StringFormat=' \{0\}'}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Resources.Sticker, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="ForwardStickerTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding From.FullName2}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.Sticker, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PinnedClearHistoryTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width ="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.RowSpan="2" Width="4" Margin="0" BorderThickness="0" Background="{StaticResource TelegramBadgeAccentBrush}"/>
            <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Resources.PinnedMessage, Source={StaticResource Strings}}" Style="{StaticResource ReplyCaptionStyle}"/>
            <TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Resources.MessageActionClearHistory, Source={StaticResource Strings}}" Style="{StaticResource ReplyBodyStyle}"/>
        </Grid>
    </DataTemplate>
</ResourceDictionary>





